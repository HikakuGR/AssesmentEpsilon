@page "/Login"
@using IdentityModel.Client
@inject HttpClient client
@inject NavigationManager navigationManager


<h3>Login</h3>

@code {
    protected override async Task OnInitializedAsync()
    {        
        var disco = await this.client.GetDiscoveryDocumentAsync("https://localhost:6001");
        if (disco.IsError)
        {
            Console.WriteLine(disco.Error);
            return;
        }
        // request token
        var tokenResponse = await this.client.RequestClientCredentialsTokenAsync(new ClientCredentialsTokenRequest
        {
                Address = disco.TokenEndpoint,

                ClientId = "client",
                ClientSecret = "secret",
                Scope = "api1"
            });

        if (tokenResponse.IsError)
        {
            Console.WriteLine(tokenResponse.Error);
            return;
        }

        Console.WriteLine(tokenResponse.Json);

        // call api
       
        client.SetBearerToken(tokenResponse.AccessToken);

        var response = await client.GetAsync("https://localhost:6001/api/customer/Login");
        if (!response.IsSuccessStatusCode)
        {
            Console.WriteLine(response.StatusCode);
        }
        else
        {           
            navigationManager.NavigateTo("/");
        }
    }
}
